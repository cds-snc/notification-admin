{% macro tou_dialog() %}
  <dialog id="tou-dialog" class="max-w-screen-lg p-6 pt-6 md:pb-20 md:px-20 lg:rounded-xl flex flex-col w-full lg:border-4 lg:border-gray-300" data-testid="tou-dialog">
    <button id="tou-close" class="absolute top-0 right-0 p-4 mr-10 mt-4">
      <i aria-hidden="true" class="mr-2 fa-solid fa-fas fa-x"></i> 
      <span class="sr-only">{{ _('Close') }}</span>
    </button>
    <h2 id="tou-heading" class="heading-medium md:heading-large mt-0 mb-4 py-4" data-testid="tou-heading">{{ _('Review and agree to the terms of use') }}</h2>
    <div id="tou-terms" class="overflow-y-scroll overflow-x-hidden p-4 lg:p-8" tabindex="0" data-testid="tou-terms" aria-describedby="tou-heading">
      
        

  

        
  
        <h1 class="heading-large">GC Notify terms of use</h1>
      
      <div class=" page-content terms">
        
    <h2 class="wp-block-heading" id="h-your-responsibilities">Your responsibilities</h2>
    
    
    
    <p><em>For CDS responsibilities, read GC Notify’s </em><a href="https://notification.canada.ca/service-level-agreement"><em>service level agreement</em></a><em>.</em></p>
    
    
    
    <h2 class="wp-block-heading" id="h-accept-conditions-including-those-in-our-privacy-notice-nbsp">Accept conditions, including those in our <a href="https://notification.canada.ca/privacy">Privacy notice</a>&nbsp;</h2>
    
    
    
    <p>We may suspend your account or service if you break these terms or misuse GC Notify. Misuse includes creating duplicate services or services incompatible with your original purpose.</p>
    
    
    
    <h2 class="wp-block-heading" id="h-accept-sending-limits">Accept sending limits</h2>
    
    
    
    <p>We apply limits to maintain our <a href="https://notification.canada.ca/service-level-objectives">service level objectives</a>. To discuss these limits, <a href="https://notification.canada.ca/contact">contact us</a>.</p>
    
    
    
    <div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-1 wp-block-columns-is-layout-flex">
    <div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
    <p><strong>Daily limit per service:</strong></p>
    </div>
    
    
    
    <div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
    <p>10,000 emails<br>1000 text messages</p>
    </div>
    </div>
    
    
    
    <div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-2 wp-block-columns-is-layout-flex">
    <div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
    <p><strong>Annual limit per service </strong>(April 1 to March 31)<strong>:</strong></p>
    </div>
    
    
    
    <div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
    <p>10 million emails<br>25,000 text messages</p>
    </div>
    </div>
    
    
    
    <h2 class="wp-block-heading">Accept risks when sending text messages</h2>
    
    
    
    <p>Texts are:</p>
    
    
    
    <ul>
    <li>Unencrypted, and have other <a href="https://datatracker.ietf.org/doc/html/rfc5724#section-4">security issues</a>. Bad actors may be able to impersonate your service.&nbsp;</li>
    
    
    
    <li>At higher risk than email for delay, delivery failure, or lack of information about delivery status.&nbsp;</li>
    
    
    
    <li>Unreliable for phone numbers outside Canada. We cannot show delivery status for international texts.</li>
    </ul>
    
    
    
    <h2 class="wp-block-heading" id="h-manage-and-protect-personal-information-of-your-recipients">Manage and protect personal information of your recipients</h2>
    
    
    
    <p>GC Notify holds information temporarily but your organization is responsible for that information.&nbsp;</p>
    
    
    
    <ul>
    <li>Communicate with recipients about incidents involving personal information. Contact your <a href="https://www.tbs-sct.canada.ca/ap/atip-aiprp/coord-eng.asp">privacy office</a> and follow their policies.&nbsp;</li>
    
    
    
    <li>Respond to requests under the <a href="https://laws-lois.justice.gc.ca/eng/acts/A-1/index.html"><em>Access to Information Act</em></a> and <a href="https://laws-lois.justice.gc.ca/eng/ACTS/P-21/index.html"><em>Privacy Act</em></a> or similar requests under your jurisdiction’s legislation. For support, <a href="https://notification.canada.ca/contact">contact us</a>.</li>
    
    
    
    <li>Follow your jurisdiction’s legislation and policies, including for branding, language or privacy.</li>
    </ul>
    
    
    
    <h2 class="wp-block-heading" id="h-get-consent-before-sending-messages">Get consent before sending messages</h2>
    
    
    
    <ul>
    <li>Follow your organization’s policies and check messages are:<br>(a) Within scope of the consent; for example, if recipient consented to communications about their application, or<br>(b) If there’s no explicit consent, consistent with the purpose for which recipient gave contact information under <a href="https://laws-lois.justice.gc.ca/eng/ACTS/P-21/page-1.html#h-397260:~:text=Sch.%20II%20%E2%80%9C6%E2%80%9D-,Protection,-of%20Personal%20Information"><em>Privacy Act,</em> s.7</a>. You may be able to email or text recipients who consented to mail or phone calls.</li>
    </ul>
    
    
    
    <ul>
    <li>Check phone numbers can receive texts for free or that the owner understands they may be charged.</li>
    </ul>
    
    
    
    <h2 class="wp-block-heading" id="h-keep-accurate-contact-information">Keep accurate contact information</h2>
    
    
    
    <ul>
    <li>Use<strong> </strong>accurate, in-use email addresses. We may suspend your service if, in a 24 hour period, you send 10% or more of your email messages to problem addresses.</li>
    
    
    
    <li>Use accurate, in-use mobile phone numbers. Do not send to landlines.</li>
    </ul>
    
    
    
    <h2 class="wp-block-heading" id="h-send-information-that-s-unclassified-or-protected-a-only">Send information that’s unclassified or Protected A only</h2>
    
    
    
    <ul>
    <li>Assess context to decide what <a href="https://www.tbs-sct.canada.ca/pol/doc-eng.aspx?id=32614&amp;section=html">degree of injury</a> could result from release of personal information, either accidentally or by a bad actor.</li>
    
    
    
    <li>Use GC Notify for <a href="https://www.tpsgc-pwgsc.gc.ca/esc-src/protection-safeguarding/niveaux-levels-eng.html#s2">low-sensitivity personal information</a>.&nbsp;</li>
    </ul>
    
    
    
    <h2 class="wp-block-heading" id="h-practice-continuous-security">Practice continuous security</h2>
    
    
    
    <ul>
    <li>Use a valid government email and a mobile device with a Canadian phone number to create your account and for 2-factor authentication.</li>
    
    
    
    <li>Create your GC Notify account with a work email address only you can access. Do not share inboxes, account information or passwords, even among staff.</li>
    
    
    
    <li>Follow the <a href="https://notification.canada.ca/security">steps in our Security notice</a> and report any security breach or vulnerability using the <a href="https://digital.canada.ca/security-notice/">CDS process</a>.</li>
    
    
    
    <li>Follow 11.4 and 11.6 of Amazon Web Service (AWS) <a href="https://aws.amazon.com/service-terms/">Service Terms</a>.</li>
    
    
    
    <li>Secure your API keys and follow our rules for <a href="https://documentation.notification.canada.ca/en/send.html#check-status-repair-and-resend-messages">API calls and unprocessed requests</a>.</li>
    </ul>
    
    
    
    <p><em>Last updated: November 2, 2023<br><br><a href="https://notification.canada.ca/terms-202304">Previous version</a></em></p>
    
      </div>
      
    {# <button
      type="button"
      class="button text-base outline-none focus:shadow-outline disabled mt-20"
      name="button_pressed"
      value="agree"
      data-testid="tou-agree-button"
      disabled
      id="tou-accept"
    >
    <svg xmlns="http://www.w3.org/2000/svg" class="fill-current text-white mr-3" width="24" height="24" viewBox="0 0 24 24"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg>
    <svg class="animate-spin -ml-1 mr-3 h-8 w-8 fill-current text-white hidden text-lg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
      {{ _('Agree') }}
    </button> #}
          
    </div>
    
    <div class="mt-12 flex">
      <button
      type="button"
      class="button text-base outline-none focus:shadow-outline disabled"
      name="button_pressed"
      value="agree"
      data-testid="tou-agree-button"
      disabled
      id="tou-accept"
    >
      {{ _('Agree') }}
    </button>
    <button
      type="button"
      class="button button-secondary text-base outline-none focus:shadow-outline ml-6"
      name="button_pressed"
      value="agree"
      data-testid="tou-agree-cancel"
      id="tou-cancel"
    >
      {{ _('Cancel') }}
    </button>
    {#
    <div class="w-full text-center">
        <div class="scroll-text">
          Scroll down to continue
        </div>
        <div class="arrowz"></div>
      </div>
    </div>
    #}
  </dialog>

  {% block page_script %}
    {#<script nonce="{{ request_nonce }}" src="{{ asset_url('javascripts/touDialog.min.js') }}"></script>    #}
    <script nonce="{{ request_nonce }}">
    /**
 * Initializes the Terms of Use dialog and adds event listeners.
 */
(function () {
  "use strict";

  // HTML elements
  const dialog = document.getElementById("tou-dialog");
  const err_msg = document.getElementById("terms-error");
  const terms = document.getElementById("tou-terms");
  const accept = document.getElementById("tou-accept");
  const form = document.querySelector("#tou-dialog form");
  const trigger = document.getElementById("tou-dialog-trigger");
  const form_agree = document.querySelector("input[name='tou_agreed']");
  const close_button = document.getElementById("tou-close");
  const status = document.getElementById("tou-status");

  // Close the dialog when the user clicks outside of it
  // dialog.addEventListener('mousedown', function(event) {
  //   // Check if the click event's target is the dialog itself
  //   if (event.target === dialog) {
  //     // If it is, close the dialog
  //     closeModal();
  //   }
  // });

  // Show the dialog when the trigger button is clicked
  trigger.addEventListener("click", function () {
    openModal();
  });

  // If the user tries to close the dialog using the escape key, show a message
  // that the terms must be accepted before dismissing the dialog
  document.addEventListener("keydown", function (event) {
    if (event.key === "Escape") {
      closeModal();
    }
  });

  // Add agree button click listener that closes the modal and sets the form_agree value to true
  accept.addEventListener("click", function (e) {
    form_agree.value = "true";
    // update icons
    status.querySelector("svg").classList.remove('fa-x', 'text-red');
    status.querySelector("svg").classList.add('fa-check','text-green-300');

    // update text, add aria-hidden
    status.querySelector("#tou-not-complete").classList.add('hidden');
    status.querySelector("#tou-not-complete").setAttribute('aria-hidden', true);
    status.querySelector("#tou-complete").classList.remove('hidden');
    status.querySelector("#tou-complete").removeAttribute('aria-hidden');

    closeModal();
  });

  // Add close button click listener that closes the modal
  close_button.addEventListener("click", function (e) {
    closeModal();
  });

  // add event handler that enables submit button when the user has scrolled to the bottom of #tou-terms
  terms.addEventListener("scroll", function () {
    // set disabled=true and remove class disabled when div is fully scrolled
    if (terms.scrollHeight - terms.scrollTop <= terms.clientHeight + 5) {
      accept.disabled = false;
      accept.classList.remove("disabled");
    }
  });

  function set_trigger_focus() {
    trigger.focus();
  }

  function openModal() {
    document.body.style.overflow = "hidden";
    dialog.showModal();

    // if the terms dont need to be scrolled, enable the submit button and remove the disabled class
    if (
      form_agree.value === "true" ||
      terms.scrollHeight - terms.scrollTop <= terms.clientHeight + 5
    ) {
      accept.disabled = false;
      accept.classList.remove("disabled");
    } else {
      accept.disabled = true;
      accept.classList.add("disabled");
    }

    terms.focus();
  }

  function closeModal() {
    document.body.style.overflow = "auto";
    dialog.close();
    set_trigger_focus();
  }
})();
</script>
  {% endblock %}
{% endmacro %}

{% macro tou_dialog_trigger(button_text) %}
  <div class="flex md:items-center flex-col md:flex-row ">
    <a href="#" class="font-bold" id="tou-dialog-trigger" aria-describedby="tou-status">{{ button_text }}</a>
    <span id="tou-status" class="mt-4 md:mt-0 md:ml-8 text-small font-bold flex items-center">
      <i aria-hidden="true" class="mr-2 fa-solid fa-fas fa-x text-red"></i> 
      <span id="tou-not-complete">{{ _('Not completed') }}</span>
      <span id="tou-complete" class="hidden" aria-hidden="true">{{ _('Completed') }}</span>
  </div>
  <input type="hidden" class="display-none" name="tou_agreed" value="false">
{% endmacro %}
