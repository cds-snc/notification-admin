{% macro tiptap_editor(id, initialContent) %}
    <div id="tiptap-editor-{{ id }}"></div>
    
    <script nonce="{{ request_nonce }}">
        // Allow multiple editors on the same page
        // Only load tiptap once
        if (!window.tiptapLoaded) {
            var script = document.createElement('script');
            script.src = '{{ asset_url("javascripts/tiptap.min.js") }}';
            script.nonce = '{{ request_nonce }}';
            script.onload = function() {
                window.tiptapLoaded = true;
                if (window.Tiptap) {
                    Tiptap.load(document.getElementById('tiptap-editor-{{ id }}'), '{{ id }}', `{{ initialContent }}`);
                }
            };
            document.head.appendChild(script);
        } else {
            // TipTap already loaded, initialize immediately
            if (window.Tiptap) {
                Tiptap.load(document.getElementById('tiptap-editor-{{ id }}'), '{{ id }}', `{{ initialContent }}`);
            }
        }
    </script>
    <input type="hidden" id="{{ id }}" name="{{ id }}">
{% endmacro %}