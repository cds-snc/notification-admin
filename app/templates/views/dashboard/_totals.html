{% from "components/big-number.html" import big_number_with_status, big_number_review_emails_with_status %}
{% from "components/message-count-label.html" import message_count_label, problem_email_label %}

{% set sent_single = _('sent-dashboard-single') %}
{% set sent_plural = _('sent-dashboard-plural') %}

{% set address_single = _('address') %}
{% set address_plural = _('addresses') %}
<div class="ajax-block-container">
  <h2 class="heading-medium mt-8">
    {% if config["FF_BOUNCE_RATE_V1"] or current_service.id in config["FF_ABTEST_SERVICE_ID"] %}
      {{ _("Email in the last 24 hours") }}
    {% else %}
      {{ _("Sent in the last week") }}
    {% endif %}
  </h2>
  <div class="grid-row contain-floats">
    <div id="total-email" class="{{column_width}}">
      {{ big_number_with_status(
        statistics['email']['requested'],
        message_count_label(statistics['email']['requested'], 'email', suffix=sent_single, suffix_plural=sent_plural),
        statistics['email']['failed'],
        statistics['email']['failed_percentage'],
        statistics['email']['show_warning'],
        failure_link=url_for(".view_notifications", service_id=service_id, message_type='email', status='failed') if statistics['email']['failed'] > 0 else None,
        link=url_for(".view_notifications", service_id=service_id, message_type='email', status='sending,delivered,failed'),
        smaller=smaller_font_size
      ) }}
    </div>

    <div id="problem-email-addresses" class="{{column_width}}">
      {% if config["FF_BOUNCE_RATE_V1"] or current_service.id in config["FF_ABTEST_SERVICE_ID"] %}
        {{ big_number_review_emails_with_status(
          number=bounce_rate["bounce_total"],
          label=problem_email_label(bounce_rate["bounce_total"]),
          problem_percentage=bounce_rate["bounce_percentage"],
          bounce_status=bounce_rate["bounce_status"],
          bounce_threshold=bounce_rate["below_threshold"],
          failure_link=url_for('.problem_emails', service_id=service_id) if bounce_rate["bounce_percentage"] > 0 else None,
          link=None,
          smaller=smaller_font_size,
          failure_link_label=_("Review email addresses")
        ) }}
      {% else %}
        {{ big_number_with_status(
          statistics['sms']['requested'],
          message_count_label(statistics['sms']['requested'], 'sms', suffix=sent_single, suffix_plural=sent_plural),
          statistics['sms']['failed'],
          statistics['sms']['failed_percentage'],
          statistics['sms']['show_warning'],
          failure_link=url_for(".view_notifications", service_id=service_id, message_type='sms', status='failed'),
          link=url_for(".view_notifications", service_id=service_id, message_type='sms', status='sending,delivered,failed'),
          smaller=smaller_font_size
        ) }}
      {% endif%}
    </div>

    {% if current_service.has_permission('letter') %}
      <div id="total-letters" class="{{column_width}}">
        {{ big_number_with_status(
          statistics['letter']['requested'],
          message_count_label(statistics['letter']['requested'], 'letter', suffix=sent_single, suffix_plural=sent_plural),
          statistics['letter']['failed'],
          statistics['letter']['failed_percentage'],
          statistics['letter']['show_warning'],
          failure_link=url_for(".view_notifications", service_id=service_id, message_type='letter', status='failed'),
          link=url_for(".view_notifications", service_id=service_id, message_type='letter', status=''),
          smaller=smaller_font_size
        ) }}
      </div>
    {% endif %}
    </div>
    {% if config["FF_BOUNCE_RATE_V1"] or current_service.id in config["FF_ABTEST_SERVICE_ID"] %}
    <div id="total-sms">
    <h2 class="heading-medium mt-8">
      {{ _('Text messages in the last 24 hours') }}
    </h2>
      {{ big_number_with_status(
        statistics['sms']['requested'],
        message_count_label(statistics['sms']['requested'], 'sms', suffix=sent_single, suffix_plural=sent_plural),
        statistics['sms']['failed'],
        statistics['sms']['failed_percentage'],
        statistics['sms']['show_warning'],
        failure_link=url_for(".view_notifications", service_id=service_id, message_type='sms', status='failed'),
        link=url_for(".view_notifications", service_id=service_id, message_type='sms', status='sending,delivered,failed'),
        smaller=smaller_font_size
      ) }}
    </div>
  {% endif %}
  </div>
</div>
