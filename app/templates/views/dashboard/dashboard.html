{% extends "admin_template.html" %}

{% from "components/big-number.html" import big_number, big_number_with_status %}
{% from "components/show-more.html" import show_more %}
{% from "components/message-count-label.html" import message_count_label %}
{% from "components/table.html" import list_table, field, right_aligned_field_heading, hidden_field_heading %}
{% from "components/ajax-block.html" import ajax_block %}

{% block service_page_title %}
  {{ _('Dashboard') }}
{% endblock %}

{% block maincolumn_content %}

  <div class="dashboard">

    <h1 class="heading-large">{{ _('Dashboard') }}</h1>
    {% if current_user.has_permissions('manage_templates') or current_user.has_permissions('send_messages') %}
      {% include 'views/dashboard/task-shortcuts.html' %}
    {% endif %}

    {% if partials['has_scheduled_jobs'] %}
      <h2 class="heading-medium mt-8">{{ _("Scheduled sends") }}</h2>
      {{ ajax_block(partials, updates_url, 'upcoming', interval=5) }}
    {% endif %}

    {% if config["FF_SMS_PARTS_UI"] %}
      <h2 class="heading-medium mt-8">
        {{ _('Usage today') }}
      </h2>
      {{ ajax_block(partials, updates_url, 'daily_totals', interval=5) }}
    {% endif %}

    {{ ajax_block(partials, updates_url, 'weekly_totals', interval=5) }}

    <h2 class="heading-medium mt-8">
      {{ _('Daily Limits') }}
    </h2>
    <div class="grid-row contain-floats">
      <div id="email-daily-limits" class="w-1/2 float-left py-0 px-0 px-gutterHalf box-border">
        {{ big_number_with_status(
          number=0,
          secondary_number=" / {}".format(partials["daily_limits"]["email_limit"]),
          label="emails",
          secondary_smallest=True
        ) }}
      </div>
      <div id="sms-daily-limits" class="w-1/2 float-left py-0 px-0 px-gutterHalf box-border">
        {{ big_number_with_status(
          number=0,
          secondary_number=" / {}".format(partials["daily_limits"]["sms_limit"]),
          label="text messages",
          secondary_smallest=True
        ) }}
      </div>
    </div>
    {{ show_more(
      url_for('.service_settings', service_id=current_service.id),
      _('Manage daily limits')
    ) }}
    </div>

    {% if partials['has_template_statistics'] %}
      <h2 class="heading-medium mt-8">{{ _("Templates used") }}</h2>
      {{ ajax_block(partials, updates_url, 'template-statistics', interval=5) }}
      {{ show_more(
        url_for('.template_usage', service_id=current_service.id),
        _('See all templates used')
      ) }}
    {% endif %}

    {% if partials['has_jobs'] %}
      <h2 class="heading-medium mt-8">{{ _("Bulk sends") }}</h2>
      {{ ajax_block(partials, updates_url, 'jobs', interval=5) }}
      {{ show_more(
        url_for('.view_jobs', service_id=current_service.id),
        _('See all bulk sends')
      ) }}
    {% endif %}

  </div>

{% endblock %}
