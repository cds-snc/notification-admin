{% from 'components/message-count-label.html' import message_count_label %}

<div class="w-full float-left py-0 px-0 px-gutterHalf box-border">
  {% if template._template.archived %}
    <p class="hint">
      {{ _('This template was deleted') }} <span class="relative-time-past">{{ template._template.updated_at }}</span>.
    </p>
  {% elif not current_user.has_permissions('send_messages', 'manage_api_keys', 'manage_templates', 'manage_service') or not user_has_template_permission %}
    <p class="mt-4 block clear-both contain-floats {% if template.template_type != 'sms' %}mb-12 clear-both contain-floats{% endif %}">
      {{ _('If you need to send this') }}
      {{ message_count_label(1, template.template_type, suffix='') }}
      {{ _('or edit this template, contact your service manager.') }}
    </p>
  {% else %}
    <div class="mb-12 clear-both contain-floats">
      <div class="grid-row contain-floats">
        {% if template.template_type == 'letter' %}
          {% if current_user.has_permissions('send_messages', restrict_admin_usage=True) %}
            <div class="w-1/2 float-left py-0 px-0 px-gutterHalf box-border">
              <a href="{{ url_for(".set_sender", service_id=current_service.id, template_id=template.id) }}" class="pill-separate-item">
                {{ _('Send') }}
              </a>
            </div>
          {% endif %}
        {% else %}
          {% if current_user.has_permissions('send_messages', restrict_admin_usage=True) %}
            <div class="w-1/2 float-left py-0 px-0 px-gutterHalf box-border">
              <a href="{{ url_for(".set_sender", service_id=current_service.id, template_id=template.id) }}" class="pill-separate-item">
                {{ _('Send') }}
              </a>
            </div>
          {% endif %}
          {% if current_user.has_permissions('manage_templates') %}
            <div class="w-1/2 float-left py-0 px-0 px-gutterHalf box-border">
              <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="pill-separate-item">
                {{ _('Edit') }}
              </a>
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
<div class="w-full float-left py-0 px-0 px-gutterHalf box-border template-container">
  {% if current_user.has_permissions('manage_templates') and template.template_type == 'letter' %}
    {% if not current_service.letter_branding_id %}
      <a href="{{ url_for(".request_letter_branding", service_id=current_service.id, from_template=template.id) }}" class="edit-template-link-letter-branding">Add logo</a>
    {% endif %}
    <a href="{{ url_for(".edit_template_postage", service_id=current_service.id, template_id=template.id) }}" class="edit-template-link-letter-postage">Change</a>
    <a href="{{ url_for(".edit_service_template", service_id=current_service.id, template_id=template.id) }}" class="edit-template-link-letter-body">Edit</a>
    {% if current_service.count_letter_contact_details %}
      <a href="{{ url_for(".set_template_sender", service_id=current_service.id, template_id=template.id) }}" class="edit-template-link-letter-contact">Edit</a>
    {% else %}
      <a href="{{ url_for(".service_add_letter_contact", service_id=current_service.id, from_template=template.id) }}" class="edit-template-link-letter-contact">Edit</a>
    {% endif %}
  {% endif %}
  {{ template|string|translate_preview_template }}
</div>
