{% extends "withnav_template.html" %}
{% from "components/banner.html" import banner_wrapper %}
{% from "components/table.html" import list_table, field, hidden_field_heading %}
{% from "components/api-key.html" import api_key %}
{% from "components/page-header.html" import page_header %}
{% from "components/page-footer.html" import page_footer %}

{% block service_page_title %}
  {{ _('API keys') }}
{% endblock %}

{% block maincolumn_content %}
  {% set heading_1 = _('API keys') %}
  {{ page_header(
    heading_1,
    back_link=url_for('main.api_integration', service_id=current_service.id)
  ) }}
  
  {% set empty_txt = _('You haven’t created any API keys yet') %}
  {% set keys_txt = _('API keys') %}
  {% set heading_1 = _('API keys') %}
  {% set heading_2 = _('Action') %}
  <div class="body-copy-table">
    {% call(item, row_number) list_table(
      current_service.api_keys,
      empty_message=empty_txt,
      caption=keys_txt,
      caption_visible=false,
      field_headings=[
        heading_1,
        heading_2
      ],
      field_headings_visible=False
    ) %}
      {% call field() %}
        <div class="file-list">
          {{ item.name }}
          {% if (current_user.platform_admin and 
              'total_sends' in item and
              'email_sends' in item and
              'sms_sends' in item )  %}
            <div class="hint">
              {{ "{:,}".format(item.total_sends) }} {{ _('total sends') }} ({{ "{:,}".format(item.email_sends) }} {{ _('email') }}, {{ "{:,}".format(item.sms_sends) }} {{ _('sms') }})
            </div>
          {% endif %}
          <div class="hint">
            {% if current_user.platform_admin %}
              {{ _('Key Type:') }}
            {% endif %}
            {% if item.key_type == 'normal' %}
              {{ _('Live – sends to anyone') }}
            {% elif item.key_type == 'team' %}
              {{ _('Team and safelist – limits who you can send to') }}
            {% elif item.key_type == 'test' %}
              {{ _('Test – pretends to send messages') }}
            {% endif %}
          </div>
          {% if current_user.platform_admin %}
            <div class="hint">
              {{ _('Created:') }} <span class="local-datetime-full">{{ item.created_at }}</span>
            </div>
            <div class="hint">
              {{ _('Expires') }}: <span class="local-datetime-full">{{ item.expiry_date }}</span>
            </div>
            <div class="hint">
              {{ _('Last used') }}: <span class="local-datetime-full">{{ item.last_send }}</span>
            </div>
          {% endif %}
        </div>
      {% endcall %}
      {% if item.expiry_date %}
        {% call field(align='right') %}
          <span class='hint'>{{ _('Revoked') }} <span class="local-datetime-short">{{ item.expiry_date }}</span></span>
        {% endcall %}
      {% else %}
        {% call field(align='right', status='error') %}
          <a href='{{ url_for('.revoke_api_key', service_id=current_service.id, key_id=item.id) }}'>{{ _('Revoke') }}</a>
        {% endcall %}
      {% endif %}
    {% endcall %}
  </div>

  <div class="js-stick-at-bottom-when-scrolling">
    <a href="{{ url_for('.create_api_key', service_id=current_service.id) }}" class="button button-secondary">{{ _('Create an API key') }}</a>
  </div>

{% endblock %}
