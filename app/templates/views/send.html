{% extends "admin_template.html" %}
{% from "components/page-header.html" import page_header %}
{% from "components/file-upload.html" import file_upload %}
{% from "components/message-count-label.html" import recipient_count_label %}
{% set page_title = _('Upload a list of recipients') %}

{% block service_page_title %}
  {{ page_title }}
{% endblock %}
{% block maincolumn_content %}
  {{
    page_header(
      page_title,
      back_link=url_for(
        'main.send_one_off',
        service_id=current_service.id,
        template_id=template.id
      )
    )
  }}

  <div class="page-footer mb-12 clear-both contain-floats">
    {{ file_upload( form.file, button_text=_('Choose a file')) }}
  </div>

  <p>
    {{ _('Save your file as a') }} 
    {% set csv_acronym = _('Comma Separated Values') %}
    {% set tsv_acr = _('Tab Separated Values') %} 
    {% set ods_acronym = _('Open Document Spreadsheet') %}
    <span class="sr-only">{{ csv_acronym }}</span><span aria-hidden="true">{{ _('CSV') }}</span>, 
    <span class="sr-only">{{ tsv_acr }}</span><span aria-hidden="true">{{ _('TSV') }}</span>, 
    <span class="sr-only">{{ ods_acronym }}</span><span aria-hidden="true">{{ _('ODS') }}</span>
    {{ _('or Microsoft Excel spreadsheet') }}.
  </p>

  <p>
    {{ _("Your file must include columns with recipients and variables from your personalised message.") }}
  </p>

  {% include "partials/csv-send.html" %}

<script>
  function isIE() {
    var ua = navigator.userAgent;
    /* MSIE used to detect old browsers and Trident used to newer ones*/
    var is_ie = ua.indexOf("MSIE ") > -1 || ua.indexOf("Trident/") > -1;

    return is_ie;
  }

  /* Alert if browser is IE */
  /*
  note this is in sent-test.html + send.html
  the target el to replace is different
  */
  if (isIE()) {
    var text =
      "We do not support Internet Explorer. Please try again using a different web browser, such as Google Chrome, Mozilla Firefox, or Microsoft Edge.";

    if (window.APP_LANG == "fr") {
      text =
        "Nous ne supportons pas Internet Explorer. Veuillez r√©essayer en utilisant un autre navigateur Web, tel que Google Chrome, Mozilla Firefox ou Microsoft Edge.";
    }

    var element = document.getElementById("file-upload-button");
    var newEl = document.createElement("p");

    newEl.innerHTML = '<span style="color:red;">'+text+'</span>';

    element.parentNode.replaceChild(newEl, element);
  }
</script>

{% endblock %}
