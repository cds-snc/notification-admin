{% from "components/buttons.html" import nav_button %}

{% set lang_switch = 'EN' %}
{% set long_lang_switch = 'English' %}

{% if session["userlang"] == "en" %}
  {% set lang_switch = 'FR' %}
  {% set long_lang_switch = 'Fran√ßais' %}
{% endif %}

<div class="container px-gutterHalf">
  <!-- start sub nav -->
  <div class="pt-5 lg:justify-between grid md:grid-cols-3">

    <div class="pb-4">
      {% if session["userlang"] == "en" %}
        <img
          alt="{{ _('Government of Canada') }}"
          width="250"
          class="focus:bg-yellow focus:outline-yellow focus:border-yellow focus:border-2"
          src="{{ asset_s3_url('gov-canada-en.svg') }}"
        />
      {% else %}
        <img
          alt="{{ _('Government of Canada') }}"
          width="250"
          class="focus:bg-yellow focus:outline-yellow focus:border-yellow focus:border-2"
          src="{{ asset_s3_url('gov-canada-fr.svg') }}"
        />
      {% endif %}
    </div>
      <div class="flex w-full justify-start md:justify-center md:col-start-2 items-center md:mx-auto" id="skiplink-container">
          <a href="#main_content" class="skiplink px-2 py-2">{{ _('Skip to main content') }}</a>
      </div>
    <!-- start sub nav -->
    <nav aria-label="{{ _('Your account and language') if current_user.is_authenticated else _('Sign-in and language') }}"
         class="xs:hidden smaller:hidden sm:hidden md:flex">
      <ul class="flex w-full justify-end">
        {% if current_user.is_authenticated %}
          {% include 'partials/nav/account_menu.html' %}
        {% else %}
          <li>
            {{ nav_button(
              href=url_for('main.sign_in'),
              label=_('Sign in'),
              aria_label=_('Sign in to GC Notify'),
              id_key='header-sign-in'
            ) }}
          </li>
        {% endif %}
        {% set set_lang_url = lang_url or request.full_path.rstrip('?') %}
        <li>
          {{ nav_button(
            href=url_for('main.set_lang', **{'from': set_lang_url}),
            label=long_lang_switch,
            aria_label=long_lang_switch,
            lang="fr-CA" if lang_switch == "FR" else "en-CA",
            class="mr-0 ml-5",
            id_key='header-lang'
          ) }}
        </li>
      </ul>
    </nav>
    <!-- end sub nav -->
  </div>
  <div class="py-gutterHalf">
        {% if not current_user.is_authenticated or current_user.is_authenticated and not current_user.has_permissions()
        and not platform_admin_view_ind %}
        <a href="/" id="gc-title" class="text-titlelarge min-h-target hover:underline focus:underline">
          {{ _("GC Notify") }}
        </a>
        {% else %}
        <a href="/" id="gc-title" class="underline hover:underline text-base">
          {{ _("GC Notify") }}
        </a>
        {% endif %}
    {% set url_text = current_service.name %}
    {% if platform_admin_view_ind %}
      {% set url_text = _('Admin panel') %}
    {% endif %}

    {% if current_user.is_authenticated and current_user.has_permissions() or platform_admin_view_ind %}
      <div class="max-md:flex max-md:flex-col flex-wrap gap-gutterHalf text-titlelarge text-black text-balance">
        {{ url_text }}
        {% if current_user.has_permissions() and not platform_admin_view_ind and current_service.trial_mode %}
        <a
          class="flex md:inline-flex md:ml-4 gap-2 items-baseline text-xs relative md:top-[-3px] border-0 focus:border-0"
          href="{{ url_for('main.request_to_go_live', service_id=current_service.id) }}">
            {{ badge(_('Trial'), variant='blue', id='live-banner') }}
            <span class="underline">
              {% if current_service.pending_live %}
                {{ _('Request being reviewed') }}
              {% else %}
                {{ _('Request to go live') }}
              {% endif %}
            </span>
        </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
