name: Post formatted test message to Slack

on:
  push:

jobs:
  post-formatting:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      # (No prepare step - blocks are provided inline below)

      - name: Post to Slack (incoming webhook)
        uses: slackapi/slack-github-action@v2
        with:
          slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
          # top-level text (fallback / accessibility)
          text: "Cypress a11y test failures"
          # blocks inline as a JSON string
          blocks: |
            [
              {"type":"section","text":{"type":"mrkdwn","text":"ðŸ§ªðŸ§ª *TESTING* ðŸ§ªðŸ§ª\n\n* Cypress a11y test failures *"}},
              {"type":"section","text":{"type":"mrkdwn","text":"- Test: *GCA a11y tests [LOCAL] English /terms*\n> CypressError: `cy.request()` failed trying to load:\n> https://www.bokren-link.ca/\n> We attempted to make an http request to this URL but the request failed without a response.\n> We received this error at the network level:\n> > Error: getaddrinfo ENOTFOUND www.bokren-link.ca"}}
            ]
